<div class="container-fluid p-4" style="background: #f9fafb; min-height: 100vh;">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h1 style="color: #111827; font-weight: 700; margin-bottom: 4px;">
        <i class="bi bi-box me-3" style="color: #111827;"></i>Productos
      </h1>
      <p style="color: #6b7280; font-size: 0.95rem; margin: 0;">
        Gestión de inventario y productos
      </p>
    </div>

    <button class="btn d-flex align-items-center"
            data-bs-toggle="modal"
            data-bs-target="#modalNuevoProducto"
            style="background: #111827; color: white; border: none; padding: 10px 20px;
                   border-radius: 8px; font-weight: 500;">
      <i class="bi bi-plus-lg me-2"></i>Nuevo Producto
    </button>
  </div>

  <!-- Filtros como la imagen - CORREGIDO: Agregado [formGroup] -->
  <div class="card mb-4 border-0 shadow-sm" style="border-radius: 12px; overflow: hidden;">
    <div class="card-body p-4">
      <form [formGroup]="filtrosForm">
        <div class="row align-items-center">
          <div class="col-md-3">
            <div class="mb-3">
              <label for="" class="form-label" style="color: #374151; font-weight: 500; margin-bottom: 8px;">
                Categoría
              </label>
              <div class="d-flex align-items-center">
                <i class="bi bi-tag me-2" style="color: #6b7280;"></i>
                <select class="form-select border-0 bg-transparent" formControlName="filtroCategoria"
                        style="color: #111827; font-weight: 500; padding-left: 0;">
                  <option value="todas">Todas las categorías</option>
                  <option *ngFor="let cat of categoriasUnicas" [value]="cat">{{cat}}</option>
                </select>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="mb-3">
              <label for="" class="form-label" style="color: #374151; font-weight: 500; margin-bottom: 8px;">
                Estado
              </label>
              <select class="form-select" formControlName="filtroStock"
                      style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px 12px; color: #374151;">
                <option value="todos">Todos los estados</option>
                <option value="sin-stock">Sin stock</option>
                <option value="bajo-stock">Stock bajo</option>
                <option value="en-stock">En stock</option>
              </select>
            </div>
          </div>

          <div class="col-md-3">
            <div class="mb-3">
              <label for="" class="form-label" style="color: #374151; font-weight: 500; margin-bottom: 8px;">
                Precio
              </label>
              <div class="input-group">
                <span class="input-group-text bg-white" style="border: 1px solid #e5e7eb; color: #6b7280;">S/</span>
                <input type="number" class="form-control" placeholder="Mín" style="border: 1px solid #e5e7eb;">
                <span class="input-group-text bg-white" style="border: 1px solid #e5e7eb; color: #6b7280;">-</span>
                <input type="number" class="form-control" placeholder="Máx" style="border: 1px solid #e5e7eb;">
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="mb-3">
              <label for="" class="form-label" style="color: #374151; font-weight: 500; margin-bottom: 8px;">
                Buscar
              </label>
              <div class="input-group">
                <span class="input-group-text bg-white" style="border: 1px solid #e5e7eb;">
                  <i class="bi bi-search" style="color: #6b7280;"></i>
                </span>
                <input type="text" class="form-control" placeholder="Nombre, SKU..."
                       formControlName="buscador"
                       style="border: 1px solid #e5e7eb;">
              </div>
            </div>
          </div>
        </div>
      </form>  <!-- LINEA AÑADIDA -->
    </div>
  </div>

  <!-- Tarjetas de productos como la imagen -->
  <div class="row">
    <div class="col-md-4 col-lg-3 mb-4" *ngFor="let p of productosFiltrados">
      <div class="card h-100 border-0 shadow-sm"
           style="border-radius: 12px; overflow: hidden; transition: transform 0.2s;">
        <div class="position-relative">
          <img [src]="p.img || 'assets/no-image.png'" alt="Producto"
               style="width: 100%; height: 200px; object-fit: cover; background: #f3f4f6;">
          <div class="position-absolute top-0 end-0 m-3">
            <span class="badge"
                  [ngClass]="{
                    'bg-danger': getEstado(p.stock) === 'sin-stock',
                    'bg-warning text-dark': getEstado(p.stock) === 'bajo-stock',
                    'bg-success': getEstado(p.stock) === 'en-stock'
                  }"
                  style="padding: 4px 10px; border-radius: 20px; font-size: 0.75rem;">
              {{ getEstado(p.stock).replace('-', ' ') }}
            </span>
          </div>
        </div>

        <div class="card-body p-4">
          <h6 style="color: #111827; font-weight: 600; margin-bottom: 8px; line-height: 1.3;">
            {{ p.nombre }}
          </h6>

          <div style="color: #6b7280; font-size: 0.85rem; margin-bottom: 12px;">
            <div class="mb-1">
              <i class="bi bi-tag me-1"></i>
              {{ p.categoriaNombre }}
            </div>
            <div class="mb-1">
              <i class="bi bi-box me-1"></i>
              Stock: {{ p.stock }} unidades
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-3">
            <div>
              <div style="color: #111827; font-weight: 700; font-size: 1.2rem;">
                S/ {{ p.precio | number:'1.2-2' }}
              </div>
              <small style="color: #6b7280; font-size: 0.8rem;">Precio unitario</small>
            </div>

            <button class="btn btn-sm d-flex align-items-center justify-content-center"
                    (click)="eliminarProducto(p.id)"
                    style="width: 36px; height: 36px; background: #111827; color: white;
                           border: none; border-radius: 8px;">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje si no hay productos -->
  <div *ngIf="productosFiltrados.length === 0" class="text-center py-5">
    <div class="mb-4">
      <i class="bi bi-inbox" style="font-size: 3rem; color: #d1d5db;"></i>
    </div>
    <h5 style="color: #374151; margin-bottom: 8px;">No se encontraron productos</h5>
    <p style="color: #6b7280;">Intenta con otros filtros o agrega un nuevo producto</p>
  </div>

</div>

<!-- Modal Nuevo Producto (simplificado) -->
<div class="modal fade" id="modalNuevoProducto" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content" style="border: none; border-radius: 12px;">

      <div class="modal-header" style="background: #111827; color: white; border: none; padding: 20px;">
        <h5 class="modal-title mb-0" style="font-weight: 600;">
          <i class="bi bi-plus-lg me-2"></i>Nuevo Producto
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <form [formGroup]="productoForm" (ngSubmit)="agregarProducto()">
        <div class="modal-body p-4">
          <div class="row g-3">
            <div class="col-12">
              <label for class="form-label" style="color: #374151; font-weight: 500;">Nombre</label>
              <input type="text" class="form-control" formControlName="nombre"
                     style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px;">
            </div>

            <div class="col-md-6">
              <label for class="form-label" style="color: #374151; font-weight: 500;">Categoría</label>
              <input type="text" class="form-control" formControlName="categoriaNombre"
                     style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px;">
            </div>

            <div class="col-md-6">
              <label for class="form-label" style="color: #374151; font-weight: 500;">Precio</label>
              <div class="input-group">
                <span class="input-group-text" style="border: 1px solid #e5e7eb;">S/</span>
                <input type="number" class="form-control" formControlName="precio"
                       style="border: 1px solid #e5e7eb;">
              </div>
            </div>

            <div class="col-md-6">
              <label for class="form-label" style="color: #374151; font-weight: 500;">Stock</label>
              <input type="number" class="form-control" formControlName="stock"
                     style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px;">
            </div>

            <div class="col-12">
              <label for class="form-label" style="color: #374151; font-weight: 500;">Imagen</label>
              <input type="file" class="form-control" id="imagenInput"
                     (change)="onFileSelected($event)" accept="image/*"
                     style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px;">
            </div>
          </div>
        </div>

        <div class="modal-footer border-0 p-4">
          <button type="button" class="btn" data-bs-dismiss="modal"
                  style="background: #f3f4f6; color: #374151; border: none; padding: 8px 20px; border-radius: 8px;">
            Cancelar
          </button>
          <button type="submit" class="btn" data-bs-dismiss="modal"
                  style="background: #111827; color: white; border: none; padding: 8px 24px; border-radius: 8px;">
            Guardar
          </button>
        </div>
      </form>

    </div>
  </div>
</div>


