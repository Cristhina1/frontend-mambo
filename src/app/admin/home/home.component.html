<div class="container-fluid p-4 dashboard-container">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold text-dark m-0">Dashboard General</h2>
      <p class="text-muted small m-0">Bienvenido al panel de control de Mambo Store</p>
    </div>
    <div class="date-badge px-3 py-2 bg-white rounded-pill shadow-sm text-dark fw-medium border">
      <i class="bi bi-calendar-event me-2 text-warning"></i> {{ hoy | date:'fullDate' }}
    </div>
  </div>

  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-dark" role="status"></div>
    <p class="mt-2 text-muted">Calculando estadísticas...</p>
  </div>

  <div *ngIf="!loading">

    <div class="row g-4 mb-4">
      <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100 card-kpi">
          <div class="card-body d-flex align-items-center">
            <div class="icon-circle bg-success-subtle text-success me-3">
              <i class="bi bi-currency-dollar fs-4"></i>
            </div>
            <div>
              <p class="text-muted small mb-0 text-uppercase fw-bold">Ventas Hoy</p>
              <h3 class="fw-bold text-dark m-0">S/ {{ kpis.ventasHoy | number:'1.2-2' }}</h3>
              <small class="text-success fw-bold">Ingresos netos</small>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100 card-kpi">
          <div class="card-body d-flex align-items-center">
            <div class="icon-circle bg-warning-subtle text-warning-dark me-3">
              <i class="bi bi-box-seam fs-4"></i>
            </div>
            <div>
              <p class="text-muted small mb-0 text-uppercase fw-bold">Pendientes</p>
              <h3 class="fw-bold text-dark m-0">{{ kpis.pedidosPendientes }}</h3>
              <small class="text-muted">Por despachar</small>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100 card-kpi">
          <div class="card-body d-flex align-items-center">
            <div class="icon-circle bg-danger-subtle text-danger me-3">
              <i class="bi bi-exclamation-triangle fs-4"></i>
            </div>
            <div>
              <p class="text-muted small mb-0 text-uppercase fw-bold">Stock Bajo</p>
              <h3 class="fw-bold text-dark m-0">{{ kpis.productosBajoStock }}</h3>
              <small class="text-danger fw-bold">Reponer urgente</small>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100 card-kpi">
          <div class="card-body d-flex align-items-center">
            <div class="icon-circle bg-primary-subtle text-primary me-3">
              <i class="bi bi-people fs-4"></i>
            </div>
            <div>
              <p class="text-muted small mb-0 text-uppercase fw-bold">Clientes</p>
              <h3 class="fw-bold text-dark m-0">{{ kpis.totalClientes }}</h3>
              <small class="text-primary fw-bold">Registrados</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4 mb-4" *ngIf="datosCargados">

      <div class="col-lg-8">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-white border-0 pt-4 px-4">
            <h5 class="fw-bold text-dark m-0">Rendimiento de Ventas</h5>
            <small class="text-muted">Últimos 7 días</small>
          </div>
          <div class="card-body px-4">
            <apx-chart
              [series]="ventasChartOptions.series"
              [chart]="ventasChartOptions.chart"
              [xaxis]="ventasChartOptions.xaxis"
              [plotOptions]="ventasChartOptions.plotOptions"
              [colors]="ventasChartOptions.colors"
              [dataLabels]="ventasChartOptions.dataLabels">
            </apx-chart>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-white border-0 pt-4 px-4">
            <h5 class="fw-bold text-dark m-0">Top Categorías</h5>
            <small class="text-muted">Por cantidad de productos</small>
          </div>
          <div class="card-body d-flex align-items-center justify-content-center">
            <apx-chart
              [series]="categoriasChartOptions.series"
              [chart]="categoriasChartOptions.chart"
              [labels]="categoriasChartOptions.labels"
              [colors]="categoriasChartOptions.colors"
              [legend]="categoriasChartOptions.legend"
              [plotOptions]="categoriasChartOptions.plotOptions">
            </apx-chart>
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 pt-4 px-4 d-flex justify-content-between">
        <h5 class="fw-bold text-dark m-0">Últimas Transacciones</h5>
        <button class="btn btn-sm btn-light text-muted" routerLink="/admin/compras">Ver todo</button>
      </div>
      <div class="card-body p-0">
        <div class="p-4 text-center text-muted" *ngIf="false">
           (Carga aquí tu lista de últimas ventas si la tienes)
        </div>
      </div>
    </div>

  </div> </div>
